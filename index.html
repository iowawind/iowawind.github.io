<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<div id="floating-panel">

  <Label id="stid">Street Address </Label><input class="w3-input" id="address" type="textbox" value="100 main">
  <Label id="zipid">ZIP </Label><input class="w3-input" id="zipcode" type="number" pattern="[0-9]{5}" value="52361" title="Five digit zip code" maxlength="4" size="4" />
  <input id="submit" class="button button2" type="button" value="Find Wind Turbines Near Me">
  <Label id="latid">Latitude </Label><input class="w3-input" id="latbox" type="textbox" value="41.6911" maxlength="9" size="9" >
  <Label id="lngid">Longitude </Label><input class="w3-input" id="lngbox" type="number" value="-92.1691" maxlength="9" size="9" />
  <input id="submitlat" class="button button2" type="button" value="Find Wind Turbines Near Me">
  <input id="showother" class="button button2" type="button" onclick="toggle()" value="Search by Lat Long Instead">
  <div id="legal">
  Source: <a href="http://www.co.iowa.ia.us/bosinfo/wind%20documents/Diamond%20Trail%20Wind_Turbine%20Overview_07.17.2019.pdf" target="_blank">http://www.co.iowa.ia.us/bosinfo/wind%20documents/Diamond%20Trail%20Wind_Turbine%20Overview_07.17.2019.pdf</a>
  </br>The materials on this website are provided on an as is basis, without warranty of any kind, either express or implied.
  </div>
	
  </div>
<div class="form-popup" id="results">
  <form action="/action_page.php" class="form-container">
    <div id='resultdisp'>
	<h1>Nearest:</h1>
	</div>
    <button class="button button2" type="button" class="btn cancel" onclick="closeForm()">Close</button>
  </form>
</div>
<div id="map"></div>
<!-- Replace the value of the key parameter with your own API key. -->
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBf7n1IAZPvdFuMxbZjE6B2l5hNz4aG5eQ&callback=initMap">


</script>
<script type="text/javascript">
//alert("This website was last update 9/19/2019. The markers reperesent turbines listed in the site plan https://www.co.iowa.ia.us/bosinfo/wind%20documents/Diamond%20Trail%20Wind_Turbine%20Overview_07.17.2019.pdf\n\nThe materials on this website are provided on an as is basis, without warranty of any kind, either express or implied, including without limitation, warranties of merchantability, fitness for a particular purpose, and non-infringement. This website specifically does not make any warranties or representations as to the appropriateness, quality, timeliness, accuracy or completeness of the materials.");
</script>
<script>
var map;
markerList = [];
mainMarker = [];
document.getElementById('latbox').style.display = 'none';
document.getElementById('lngbox').style.display = 'none';
document.getElementById('latid').style.display = 'none';
document.getElementById('lngid').style.display = 'none';
document.getElementById('submitlat').style.display = 'none';
function toggle(){
	if (document.getElementById('showother').value.includes('Lat'))
	{
		var latlngvis = '';
		var stvis = 'none'
		document.getElementById('showother').value = 'Search by Address Instead'
	}
	else
	{
		var latlngvis = 'none';
		var stvis = ''
		document.getElementById('showother').value = 'Search by Lat Long Instead'
	}
	document.getElementById('latbox').style.display = latlngvis;
	document.getElementById('lngbox').style.display = latlngvis;
	document.getElementById('latid').style.display = latlngvis;
	document.getElementById('lngid').style.display = latlngvis;
	document.getElementById('submitlat').style.display = latlngvis;
	
	document.getElementById('address').style.display = stvis;
	document.getElementById('zipcode').style.display = stvis;
	document.getElementById('stid').style.display = stvis;
	document.getElementById('zipid').style.display = stvis;
	document.getElementById('submit').style.display = stvis;
}


function initMap() {
  map = new google.maps.Map(
    document.getElementById('map'), {
      center: new google.maps.LatLng(41.6911, -92.1691),
      zoom: 13
    });


  var features = [
{
	position: new google.maps.LatLng(41.70773888888889, -92.28225277777777),
	id: '2019-WTE-1354-OE'
},
{
	position: new google.maps.LatLng(41.71134166666667, -92.27132222222222),
	id: '2019-WTE-1356-OE'
},
{
	position: new google.maps.LatLng(41.712183333333336, -92.26631388888889),
	id: '2019-WTE-1357-OE'
},
{
	position: new google.maps.LatLng(41.715611111111116, -92.26230555555556),
	id: '2019-WTE-1358-OE'
},
{
	position: new google.maps.LatLng(41.69799999999999, -92.2480861111111),
	id: '2019-WTE-1361-OE'
},
{
	position: new google.maps.LatLng(41.72295833333334, -92.23299722222222),
	id: '2019-WTE-1362-OE'
},
{
	position: new google.maps.LatLng(41.65680833333333, -92.26705833333334),
	id: '2019-WTE-1363-OE'
},
{
	position: new google.maps.LatLng(41.68336944444444, -92.23483333333333),
	id: '2019-WTE-1364-OE'
},
{
	position: new google.maps.LatLng(41.683625, -92.22900555555556),
	id: '2019-WTE-1365-OE'
},
{
	position: new google.maps.LatLng(41.68667222222222, -92.22449444444445),
	id: '2019-WTE-1366-OE'
},
{
	position: new google.maps.LatLng(41.698302777777776, -92.20998055555556),
	id: '2019-WTE-1367-OE'
},
{
	position: new google.maps.LatLng(41.698430555555554, -92.20485000000001),
	id: '2019-WTE-1368-OE'
},
{
	position: new google.maps.LatLng(41.70912222222223, -92.21502222222223),
	id: '2019-WTE-1369-OE'
},
{
	position: new google.maps.LatLng(41.71180833333334, -92.20999722222223),
	id: '2019-WTE-1370-OE'
},
{
	position: new google.maps.LatLng(41.7126, -92.20479444444445),
	id: '2019-WTE-1371-OE'
},
{
	position: new google.maps.LatLng(41.71290833333334, -92.19862777777779),
	id: '2019-WTE-1372-OE'
},
{
	position: new google.maps.LatLng(41.668, -92.21806388888889),
	id: '2019-WTE-1373-OE'
},
{
	position: new google.maps.LatLng(41.67822222222222, -92.20895),
	id: '2019-WTE-1374-OE'
},
{
	position: new google.maps.LatLng(41.693263888888886, -92.17842222222222),
	id: '2019-WTE-1375-OE'
},
{
	position: new google.maps.LatLng(41.722675, -92.15599166666668),
	id: '2019-WTE-1376-OE'
},
{
	position: new google.maps.LatLng(41.721694444444445, -92.14651388888889),
	id: '2019-WTE-1377-OE'
},
{
	position: new google.maps.LatLng(41.72225, -92.1401888888889),
	id: '2019-WTE-1378-OE'
},
{
	position: new google.maps.LatLng(41.722325000000005, -92.13478888888889),
	id: '2019-WTE-1379-OE'
},
{
	position: new google.maps.LatLng(41.71130277777778, -92.13675),
	id: '2019-WTE-1380-OE'
},
{
	position: new google.maps.LatLng(41.69079166666666, -92.15984166666668),
	id: '2019-WTE-1381-OE'
},
{
	position: new google.maps.LatLng(41.69790555555555, -92.1541388888889),
	id: '2019-WTE-1382-OE'
},
{
	position: new google.maps.LatLng(41.70039166666667, -92.1313611111111),
	id: '2019-WTE-1384-OE'
},
{
	position: new google.maps.LatLng(41.70445555555556, -92.12132777777776),
	id: '2019-WTE-1385-OE'
},
{
	position: new google.maps.LatLng(41.70708055555556, -92.10794444444444),
	id: '2019-WTE-1386-OE'
},
{
	position: new google.maps.LatLng(41.67831666666667, -92.13515000000001),
	id: '2019-WTE-1388-OE'
},
{
	position: new google.maps.LatLng(41.67978055555555, -92.13055),
	id: '2019-WTE-1389-OE'
},
{
	position: new google.maps.LatLng(41.66426111111111, -92.16924722222222),
	id: '2019-WTE-1392-OE'
},
{
	position: new google.maps.LatLng(41.66428333333333, -92.15560555555557),
	id: '2019-WTE-1393-OE'
},
{
	position: new google.maps.LatLng(41.66524722222222, -92.150175),
	id: '2019-WTE-1394-OE'
},
{
	position: new google.maps.LatLng(41.66773055555555, -92.13702222222223),
	id: '2019-WTE-1395-OE'
},
{
	position: new google.maps.LatLng(41.656225, -92.12240833333333),
	id: '2019-WTE-1396-OE'
},
{
	position: new google.maps.LatLng(41.66144722222222, -92.11231944444444),
	id: '2019-WTE-1397-OE'
},
{
	position: new google.maps.LatLng(41.66367222222222, -92.07855833333333),
	id: '2019-WTE-1398-OE'
},
{
	position: new google.maps.LatLng(41.707597222222226, -92.24427222222222),
	id: '2019-WTE-1405-OE'
},
{
	position: new google.maps.LatLng(41.66455555555555, -92.25145277777777),
	id: '2019-WTE-1406-OE'
},
{
	position: new google.maps.LatLng(41.69868611111111, -92.29375833333333),
	id: '2019-WTE-3937-OE'
},
{
	position: new google.maps.LatLng(41.70859444444445, -92.27691666666666),
	id: '2019-WTE-3938-OE'
},
{
	position: new google.maps.LatLng(41.68313611111111, -92.28665277777777),
	id: '2019-WTE-3939-OE'
},
{
	position: new google.maps.LatLng(41.69061388888888, -92.26786111111112),
	id: '2019-WTE-3940-OE'
},
{
	position: new google.maps.LatLng(41.69913333333333, -92.26306666666666),
	id: '2019-WTE-3941-OE'
},
{
	position: new google.maps.LatLng(41.701125000000005, -92.22615),
	id: '2019-WTE-3942-OE'
},
{
	position: new google.maps.LatLng(41.698074999999996, -92.21598888888889),
	id: '2019-WTE-3943-OE'
},
{
	position: new google.maps.LatLng(41.72380277777778, -92.13064166666666),
	id: '2019-WTE-3944-OE'
},
{
	position: new google.maps.LatLng(41.69005, -92.13951666666668),
	id: '2019-WTE-3945-OE'
},
{
	position: new google.maps.LatLng(41.67982222222222, -92.14601944444445),
	id: '2019-WTE-3946-OE'
},
{
	position: new google.maps.LatLng(41.67888611111111, -92.11824166666666),
	id: '2019-WTE-3947-OE'
},
{
	position: new google.maps.LatLng(41.66438055555555, -92.17628611111111),
	id: '2019-WTE-3948-OE'
},
{
	position: new google.maps.LatLng(41.65315, -92.101975),
	id: '2019-WTE-3949-OE'
},
{
	position: new google.maps.LatLng(41.71997777777778, -92.07568888888889),
	id: '2019-WTE-3950-OE'
},
{
	position: new google.maps.LatLng(41.71178888888889, -92.07238888888888),
	id: '2019-WTE-3951-OE'
},
{
	position: new google.maps.LatLng(41.72123055555556, -92.05818333333333),
	id: '2019-WTE-3952-OE'
},
{
	position: new google.maps.LatLng(41.70425277777778, -92.0796),
	id: '2019-WTE-3953-OE'
},
{
	position: new google.maps.LatLng(41.705761111111116, -92.28783055555556),
	id: '2019-WTE-3954-OE'
},
{
	position: new google.maps.LatLng(41.729569444444444, -92.10724444444443),
	id: '2019-WTE-3955-OE'
},
{
	position: new google.maps.LatLng(41.733808333333336, -92.10104166666666),
	id: '2019-WTE-3956-OE'
},
{
	position: new google.maps.LatLng(41.73408055555556, -92.07262222222222),
	id: '2019-WTE-3957-OE'
},
{
	position: new google.maps.LatLng(41.73549722222222, -92.04880277777778),
	id: '2019-WTE-3958-OE'
},
{
	position: new google.maps.LatLng(41.73493055555556, -92.09221111111111),
	id: '2019-WTE-3959-OE'
},
{
	position: new google.maps.LatLng(41.75309722222222, -92.11181666666666),
	id: '2019-WTE-3960-OE'
},
{
	position: new google.maps.LatLng(41.75448333333333, -92.1066361111111),
	id: '2019-WTE-3961-OE'
},
{
	position: new google.maps.LatLng(41.756369444444445, -92.10294999999999),
	id: '2019-WTE-3962-OE'
},
{
	position: new google.maps.LatLng(41.73591388888889, -92.04263888888889),
	id: '2019-WTE-3965-OE'
},
{
	position: new google.maps.LatLng(41.68029444444444, -92.24325555555555),
	id: '2019-WTE-3966-OE'
},
{
	position: new google.maps.LatLng(41.679719444444444, -92.23766111111111),
	id: '2019-WTE-3967-OE'
},
{
	position: new google.maps.LatLng(41.70814444444445, -92.22856111111112),
	id: '2019-WTE-3968-OE'
},
{
	position: new google.maps.LatLng(41.71563333333334, -92.24754166666666),
	id: '2019-WTE-3969-OE'
},
{
	position: new google.maps.LatLng(41.70892777777778, -92.23676388888889),
	id: '2019-WTE-3970-OE'
},
{
	position: new google.maps.LatLng(41.721044444444445, -92.22645277777778),
	id: '2019-WTE-3971-OE'
},
{
	position: new google.maps.LatLng(41.68333333333333, -92.18083333333334),
	id: '2019-WTE-3972-OE'
},
{
	position: new google.maps.LatLng(41.66916666666666, -92.18795833333334),
	id: '2019-WTE-3973-OE'
},
{
	position: new google.maps.LatLng(41.65692222222222, -92.19442222222223),
	id: '2019-WTE-3974-OE'
},
{
	position: new google.maps.LatLng(41.665619444444445, -92.20671388888888),
	id: '2019-WTE-3975-OE'
},
{
	position: new google.maps.LatLng(41.65640555555555, -92.22514166666667),
	id: '2019-WTE-3976-OE'
},
{
	position: new google.maps.LatLng(41.64736111111111, -92.22756666666668),
	id: '2019-WTE-3977-OE'
},
{
	position: new google.maps.LatLng(41.64048611111111, -92.21644722222223),
	id: '2019-WTE-3978-OE'
},
{
	position: new google.maps.LatLng(41.61033888888889, -92.17381666666667),
	id: '2019-WTE-3979-OE'
},
{
	position: new google.maps.LatLng(41.71483333333334, -92.07988333333333),
	id: '2019-WTE-3980-OE'
},
{
	position: new google.maps.LatLng(41.70377777777778, -92.12722777777778),
	id: '2019-WTE-3981-OE'
},
{
	position: new google.maps.LatLng(41.69778055555555, -92.091775),
	id: '2019-WTE-3982-OE'
},
{
	position: new google.maps.LatLng(41.707883333333335, -92.17628055555556),
	id: '2019-WTE-3983-OE'
},
{
	position: new google.maps.LatLng(41.711975, -92.224975),
	id: '2019-WTE-3984-OE'
},
  ]

  // Create markers.
  for (var i = 0; i < features.length; i++) {
    var marker = new google.maps.Marker({
      position: features[i].position,
      title: "Proposed Windmill " + features[i].id,
      map: map,
      icon: 'https://maps.google.com/mapfiles/ms/icons/red-dot.png'
    });
	markerList.push(marker)
    
  };
  var geocoder = new google.maps.Geocoder();
  document.getElementById('submit').addEventListener('click', function() {
    geocodeAddress(geocoder, map);
  }); 
  document.getElementById('submitlat').addEventListener('click', function() {
    console.log('a')
	setPoint(new google.maps.LatLng(parseFloat(document.getElementById('latbox').value), parseFloat(document.getElementById('lngbox').value)));
  }); 
}
//This function takes in latitude and longitude of two location and returns the distance between them as the crow flies (in km)
function calcCrow(latlon1, latlon2) 
{
  var lat1 = latlon1.lat();
  var lat2 = latlon2.lat();
  var lon1 = latlon1.lng();
  var lon2 = latlon2.lng();
  var R = 6371; // km
  var dLat = toRad(lat2-lat1);
  var dLon = toRad(lon2-lon1);
  var lat1 = toRad(lat1);
  var lat2 = toRad(lat2);

  var a = Math.sin(dLat/2) * Math.sin(dLat/2) +
    Math.sin(dLon/2) * Math.sin(dLon/2) * Math.cos(lat1) * Math.cos(lat2); 
  var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
  var d = R * c;
  return d;
}

// Converts numeric degrees to radians
function toRad(Value) 
{
    return Value * Math.PI / 180;
}
function round(value, precision) {
    var multiplier = Math.pow(10, precision || 0);
    return Math.round(value * multiplier) / multiplier;
}
function geocodeAddress(geocoder, resultsMap) {
  var address = document.getElementById('address').value + ' ' + document.getElementById('zipcode').value;
  geocoder.geocode({'address': address}, function(results, status) {
    if (status === 'OK') {
		setPoint(results[0].geometry.location)
    } else {
      alert('Geocode was not successful for the following reason: ' + status);
    }
  });
}
function setPoint(latlng){
  map.setCenter(latlng);
  points = findNearest(latlng);
  points.sort(function(first, second) {
	return first['dist'] - second['dist'];
	});
  htmltable = '<h1>Nearest 10</h1><table style="width:100%"><tr><th>ID</th><th>Distance</th></tr>';
  var total = 10;
  if (total > markerList.length)
  {
     total = markerList.length;
  }  
  for (var i = 0; i < total; i++)
  {
	htmltable = htmltable + '<tr><th>' + points[i]['des'] + '</th><th>' + points[i]['real_dist'] + '</th></tr>';
  }
  htmltable = htmltable + '</table>';
  document.getElementById('resultdisp').innerHTML = htmltable;
  openForm();
  if (mainMarker.length == 0)
  {
	var marker = new google.maps.Marker({
		map: map,
		position: latlng,
		icon: 'https://maps.google.com/mapfiles/ms/micons/POI.png'
	});
	mainMarker.push(marker)
  }
  else
  {
	mainMarker[0].setPosition(latlng)
  }
}
function findNearest(latlng){
	returnList = []
	for (var i = 0; i < markerList.length; i++) {
		var distance = calcCrow(markerList[i].position,latlng) * 0.621371;		
		var dict = {};
		markerList[i].setTitle(markerList[i].getTitle().split('\n',1)[0] + '\nDistance Away: ' + round(distance, 2) + ' miles')
		var real_dist = round(distance, 2) + ' miles'
		if (distance>=10)
		{
			markerList[i].setIcon('https://maps.google.com/mapfiles/ms/icons/green-dot.png')
		}
		else if (distance>=5)
		{
			markerList[i].setIcon('https://maps.google.com/mapfiles/ms/icons/pink-dot.png')
		}
		else if (distance>=2.5)
		{
			markerList[i].setIcon('https://maps.google.com/mapfiles/ms/icons/yellow-dot.png')
		}
		else if (distance>=1)
		{
			markerList[i].setIcon('https://maps.google.com/mapfiles/ms/icons/orange-dot.png')
		}
		else
		{
			var feet = distance*5280;
			markerList[i].setTitle(markerList[i].getTitle().split('\n',1)[0] + '\nDistance Away: ' + round(feet, 0) + ' feet')
			markerList[i].setIcon('https://maps.google.com/mapfiles/ms/icons/red-dot.png')
			real_dist = round(feet, 0) + ' feet'
		}
		dict['dist'] = distance;
		dict['des'] = "ID: " + markerList[i].getTitle().split('-OE',1)[0].split('WTE-',2)[1];
		dict['real_dist'] = real_dist
		returnList.push(dict)
	};
	return returnList;
}
function openForm() {
  document.getElementById("results").style.display = "block";
}

function closeForm() {
  document.getElementById("results").style.display = "none";
}
</script>
<style>

/* Always set the map height explicitly to define the size of the div
 * element that contains the map. */

#map {
  height: 100%;
}

/* Optional: Makes the sample page fill the window. */

html,
body {
  height: 100%;
  margin: 0;
  padding: 0;
  background: #D3D3D3;
}
#legal{
  text-align: center;
  font-size: 15px;
  font-family: 'Roboto','sans-serif';
}
#floating-panel {
  z-index: 5;
  padding: 5px;
  text-align: center;
  font-family: 'Roboto','sans-serif';
  line-height: 30px;
  padding-left: 10px;
background: #D3D3D3;
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    top: 70%;
}
/* The popup form - hidden by default */
.open-button {
  background-color: #555;
  color: white;
  padding: 16px 20px;
  border: none;
  cursor: pointer;
  opacity: 0.8;
  position: fixed;
  bottom: 23px;
  right: 28px;
  width: 280px;
}

/* The popup form - hidden by default */
.form-popup {
  display: none;
  position: fixed;
  bottom: 0;
  right: 15px;
  border: 3px solid #f1f1f1;
  z-index: 9;
}

/* Add styles to the form container */
.form-container {
  max-width: 300px;
  padding: 10px;
  background-color: white;
}

/* Full-width input fields */
.form-container input[type=text], .form-container input[type=password] {
  width: 100%;
  padding: 15px;
  margin: 5px 0 22px 0;
  border: none;
  background: #f1f1f1;
}

/* When the inputs get focus, do something */
.form-container input[type=text]:focus, .form-container input[type=password]:focus {
  background-color: #ddd;
  outline: none;
}

/* Set a style for the submit/login button */
.form-container .btn {
  background-color: #4CAF50;
  color: white;
  padding: 16px 20px;
  border: none;
  cursor: pointer;
  width: 100%;
  margin-bottom:10px;
  opacity: 0.8;
}

/* Add a red background color to the cancel button */
.form-container .cancel {
  background-color: red;
}

/* Add some hover effects to buttons */
.form-container .btn:hover, .open-button:hover {
  opacity: 1;
}
table {
  font-family: arial, sans-serif;
  border-collapse: collapse;
  width: 100%;
}

td, th {
  border: 1px solid #dddddd;
  text-align: left;
  padding: 8px;
}

tr:nth-child(even) {
  background-color: #dddddd;
}
.button {
  background-color: #4CAF50; /* Green */
  border: none;
  color: white;
  padding: 5px 32px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  margin: 4px 2px;
  cursor: pointer;
  -webkit-transition-duration: 0.4s; /* Safari */
  transition-duration: 0.4s;
}

.button1 {
  box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2), 0 6px 20px 0 rgba(0,0,0,0.19);
}

.button2:hover {
  box-shadow: 0 12px 16px 0 rgba(0,0,0,0.24),0 17px 50px 0 rgba(0,0,0,0.19);
}
</style>